"use strict";window.onload=function(){var e=document.getElementById("chart"),A=document.getElementById("pprev"),h=document.getElementById("prev"),v=document.getElementById("next"),D=document.getElementById("nnext"),t="/histories/period?",a=void 0,I=0,r=new Date,f=new Date,i=void 0;a=document.body.offsetWidth<600?10:30;var o=window.location.search.slice(1).split("&"),d=[],s=void 0;o.forEach(function(e){s=e.split("="),d.push(s[0]),d[s[0]]=s[1]}),I=0<=d.indexOf("page")&&0<d.page?d.page:1,i=t+"page="+I+"&period="+a,f.setDate(f.getDate()-a*I+1);var k=new Chart(e,{type:"bar",data:{labels:[],datasets:[{type:"bar",label:"Todo実行数",data:[],backgroundColor:"rgba(45, 235, 166, 0.2)",borderColor:"rgba(45, 235, 162, 1)",borderWidth:1,yAxisID:"y-axis-bar",stack:1},{type:"bar",label:"ルーチン実行数",data:[],backgroundColor:"rgba(54, 162, 235, 0.6)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1,xAxisID:"x-axis-bar",yAxisID:"y-axis-bar"},{type:"bar",label:"ルーチン総数",data:[],backgroundColor:"rgba(225, 62, 155, 0.2)",borderColor:"rgba(142, 42, 235, 1)",borderWidth:1,xAxisID:"x-axis-bar",yAxisID:"y-axis-bar"}]},options:{maintainAspectRatio:!1,scales:{xAxes:[{id:"x-axis-bar",stacked:!0,beginAtZero:!0,scaleLabel:{labelString:"Date"},ticks:{autoSkip:!1}}],yAxes:[{id:"y-axis-bar",type:"linear",position:"right",ticks:{beginAtZero:!0,max:1,stepSize:1}}]}}});function n(e,y){A.setAttribute("disabled",!0),h.setAttribute("disabled",!0),v.setAttribute("disabled",!0),D.setAttribute("disabled",!0);var t,a,m=document.getElementById("loading"),p=m.getAttribute("class");m.setAttribute("class",p+" c-loading--show"),(t={},a=e,$.ajax({url:a,type:"GET",cache:!1,data:t,success:function(e){return e},error:function(){return!1}})).done(function(e){"errors"in e&&(location.href="/users/login");for(var t="",a=[],r=[],i=[],o=[],d=[],s=0,n=0,l=0,b=0,c=e.length,u=0;u<y;u++){t=f.getFullYear()+"-"+("0"+(f.getMonth()+1)).slice(-2)+"-"+("0"+f.getDate()).slice(-2);var g="";f.getFullYear()!==n&&(g+=(""+f.getFullYear()).slice(-2)+"/",n=f.getFullYear()),f.getMonth()+1!==l&&(g+=("0"+(f.getMonth()+1)).slice(-2)+"/",l=f.getMonth()+1),a[u]=g+("0"+f.getDate()).slice(-2),b<c&&e[b].History.date===t?(r[u]=+e[b].History.done_todo,i[u]=+e[b].History.done_routine,o[u]=+e[b].History.total_routine,d[u]=0!==o?Math.round(+e[b].History.done_routine/+e[b].History.total_routine*100):0,s=Math.max(s,+e[b].History.done_todo,+e[b].History.total_routine),b++):(r[u]=0,i[u]=0,o[u]=0,d[u]=0),f.setDate(f.getDate()+1)}var x={labels:a,datasets:[{type:"bar",label:"Todo実行数",data:r,backgroundColor:"rgba(45, 235, 166, 0.2)",borderColor:"rgba(45, 235, 162, 1)",borderWidth:1,yAxisID:"y-axis-bar",stack:1},{type:"bar",label:"ルーチン実行数",data:i,backgroundColor:"rgba(54, 162, 235, 0.6)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1,xAxisID:"x-axis-bar",yAxisID:"y-axis-bar"},{type:"bar",label:"ルーチン総数",data:o,backgroundColor:"rgba(225, 62, 155, 0.2)",borderColor:"rgba(142, 42, 235, 1)",borderWidth:1,xAxisID:"x-axis-bar",yAxisID:"y-axis-bar"}]};k.options.scales.yAxes[0].ticks.max=s,k.options.scales.yAxes[0].ticks.stepSize=Math.max(Math.round(s/20),1),k.data=x,k.update(),m.setAttribute("class",p),A.removeAttribute("disabled"),h.removeAttribute("disabled"),1<I&&(v.removeAttribute("disabled"),D.removeAttribute("disabled"))})}function l(e){"pprev"===e.target.getAttribute("id")?I+=2:I++,i=t+"page="+I+"&period="+a,f.setTime(r.getTime()),f.setDate(f.getDate()-a*I+1),n(i,a)}function b(e){I="nnext"===e.target.getAttribute("id")?Math.max(I-2,1):Math.max(I-1,1),i=t+"page="+I+"&period="+a,f.setTime(r.getTime()),f.setDate(f.getDate()-a*I+1),n(i,a)}n(i,a),document.getElementById("pprev").addEventListener("click",l),document.getElementById("prev").addEventListener("click",l),document.getElementById("next").addEventListener("click",b),document.getElementById("nnext").addEventListener("click",b);var c=void 0;window.onresize=function(){A.setAttribute("disabled",!0),h.setAttribute("disabled",!0),v.setAttribute("disabled",!0),D.setAttribute("disabled",!0),clearTimeout(c),c=setTimeout(function(){I=1,a=600<document.body.offsetWidth?30:10,i=t+"page="+I+"&period="+a,f.setTime(r.getTime()),f.setDate(f.getDate()-a*I+1),n(i,a)},1e3)}};