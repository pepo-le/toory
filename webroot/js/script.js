"use strict";!function(t){var c=jQuery;function e(t){c(t.target).removeClass("form-error")}function a(t){var e="."+c(t.target).attr("id").replace("-check0","");c(t.target).is(":checked")?c(e).prop("disabled",!1):c(e).prop("disabled",!0)}function l(t){var e=c(t.target).find(".p-task-check__input");e.hasClass("checked")?e.removeClass("checked"):e.addClass("checked")}function p(e){c(e.target).find("input").prop("disabled",!0),c(e.target).find(".c-loading").addClass("c-loading--show");var a={Task:{id:c(e.target).children(".task-form-id").val(),task_type_id:c(e.target).children(".task-form-type").val()},_Token:{key:c(e.target).find('input[name="data[_Token][key]"]').val()},tasktype:e.data.tasktype},n="#active-"+a.tasktype,r="#done-"+a.tasktype,o=c(n).find("tr").length,i=c(r).find("tr").length,d="#task-"+a.Task.id,s=c(d).find(".task-name").html();return h(a,"/tasks/done").done(function(t){c(e.target).find(".c-loading").removeClass("c-loading--show"),200==(t=JSON.parse(t)).result.code?(c(e.target).attr("action","/tasks/cancel"),c(e.target).off("submit"),c(e.target).on("submit",{tasktype:a.tasktype},k),c(e.target).find("button").html("×"),1===i&&c(r).find("tr").hasClass("task-table__none")?(c(r).find("tbody").empty(),c(d).appendTo(r)):c(r).find("tr").each(function(t,e){var a=c(e).find(".task-name").html();return s<a?(c(d).insertBefore(e),!1):t===i-1?(c(d).appendTo(r),!1):void 0}),1===o&&(c(n).find("tbody").empty(),"todo"===a.tasktype?c(n).find("tbody").html('<tr class="task-table__none p-task-table__none"><td>今日のTodoはありません</td></tr>'):c(n).find("tbody").html('<tr class="task-table__none p-task-table__none"><td>今日のルーチンはありません</td></tr>')),l(e),c(e.target).find("input").prop("disabled",!1)):location.href="/"}),!1}function k(e){c(e.target).find("input").prop("disabled",!0),c(e.target).find(".c-loading").addClass("c-loading--show");var a={Task:{id:c(e.target).children(".task-form-id").val(),task_type_id:c(e.target).children(".task-form-type").val()},_Token:{key:c(e.target).find('input[name="data[_Token][key]"]').val()},tasktype:e.data.tasktype},n="#active-"+a.tasktype,r="#done-"+a.tasktype,o=c(n).find("tr").length,i=c(r).find("tr").length,d="#task-"+a.Task.id,s=c(d).find(".task-name").html();return h(a,"/tasks/cancel").done(function(t){c(e.target).find(".c-loading").removeClass("c-loading--show"),200==(t=JSON.parse(t)).result.code?(c(e.target).attr("action","/tasks/done"),c(e.target).off("submit"),c(e.target).on("submit",{tasktype:a.tasktype},p),c(e.target).find("button").html("○"),1===o&&c(n).find("tr").hasClass("task-table__none")?(c(n).find("tbody").empty(),c(d).appendTo(n)):c(n).find("tr").each(function(t,e){var a=c(e).find(".task-name").html();return s<a?(c(d).insertBefore(e),!1):t===o-1?(c(d).appendTo(n),!1):void 0}),1===i&&(c(r).find("tbody").empty(),"todo"===a.tasktype?c(r).find("tbody").html('<tr class="task-table__none p-task-table__none"><td>今日完了したTodoはありません</td></tr>'):c(r).find("tbody").html('<tr class="task-table__none p-task-table__none"><td>今日完了したルーチンはありません</td></tr>')),l(e),c(e.target).find("input").prop("disabled",!1)):location.href="/"}),!1}function d(n){n.preventDefault();for(var r=c(n.delegateTarget).attr("href").split("?")[0],t=c(n.delegateTarget).attr("href").split("?")[1].split("&"),o=[],e=0;t[e];e++){var a=t[e].split("=");o[a[0]]=a[1]}var i=r;h({year:o.year,month:o.month},i,"GET").done(function(t){c("#calendar").html(t);var e=void 0,a=void 0;a=(c(n.delegateTarget).attr("id"),e=new Date(o.year,+o.month-2),new Date(o.year,+o.month)),c("#prev-month").attr("href",r+"?year="+e.getFullYear()+"&month="+("0"+(+e.getMonth()+1)).slice(-2)),c("#next-month").attr("href",r+"?year="+a.getFullYear()+"&month="+("0"+(+a.getMonth()+1)).slice(-2)),c("#prev-month").on("click",d),c("#next-month").on("click",d)}).fail(function(){location.href="/users/login"})}function n(a){c.each(c("#task-table input[type=checkbox]"),function(t,e){a.target.checked?e.checked=!0:e.checked=!1})}function h(t,e){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"POST";return c.ajax({url:e,type:a,cache:!1,data:t,success:function(t){return t},error:function(){return!1}})}c(document).ready(function(){c("#active-todo .task-form").on("submit",{tasktype:"todo"},p),c("#active-routine .task-form").on("submit",{tasktype:"routine"},p),c("#done-todo .task-form").on("submit",{tasktype:"todo"},k),c("#done-routine .task-form").on("submit",{tasktype:"routine"},k),c("#prev-month").on("click",d),c("#next-month").on("click",d),c("#expire-check0").on("change",a),c("#reminder-time-check0").on("change",a),c("#reminder-datetime-check0").on("change",a),c("#expire-check0").is(":checked")?c(".expire").prop("disabled",!1):c(".expire").prop("disabled",!0),c("#reminder-time-check0").is(":checked")?c(".reminder-time").prop("disabled",!1):c(".reminder-time").prop("disabled",!0),c("#reminder-datetime-check0").is(":checked")?c(".reminder-datetime").prop("disabled",!1):c(".reminder-datetime").prop("disabled",!0),c("input[type=text]").on("change",e),c("input[type=password]").on("change",e),c("textarea").on("change",e),c("input[type=email]").on("change",e),c("input[type=radio]").on("change",e),c("select").on("change",e),c("input[type=checkbox]").on("change",e),c("#task-delete-all").on("change",n)})}();